name: Build and Release EXE

on:
  push:
    tags:
      - 'v*' # 当推送以'v'开头的标签时触发工作流

jobs:
  build:
    runs-on: windows-latest # 使用 Windows 环境构建 EXE
    
    steps:
      # 步骤1：检出代码
      - name: Checkout repository
        uses: actions/checkout@v4
        
      # 步骤2：设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # 指定 Python 版本
          
      # 步骤3：安装依赖
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
          
      # 步骤4：构建 EXE 文件
      - name: Build EXE with PyInstaller
        run: |
          pyinstaller --onefile --noconsole --name="StackingWindowGenerator" stacking_window_generator.py
          # --onefile: 创建单个可执行文件
          # --noconsole: 隐藏控制台窗口（适合 GUI 应用）
          # --name: 指定输出文件名
          
      # 步骤5：创建 Release 并上传 EXE
      - name: Create Release and Upload EXE
        uses: softprops/action-gh-release@v2
        with:
          files: dist/StackingWindowGenerator.exe
          tag_name: ${{ github.ref_name }}
          name: "Stacking Window Generator ${{ github.ref_name }}"
          body: "Automatically built executable for Stacking Window Generator"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
